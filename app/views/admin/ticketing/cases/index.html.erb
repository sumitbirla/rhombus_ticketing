<div class="pull-right">
  <select id="selAction" class="form-control" style="display: inline; width: 75%">
    <option> - - Select Action - - </option>
	  <option method="get" value="/admin/ticketing/case/new?queue_id=<%= params[:queue_id]%>">New Ticket</option>
    <option method="get" value="/admin/ticketing/case_queues">Configure Queues</option>
    <option method="post" value="/admin/ticketing/cases_delete_batch">Delete Selected</option>
    <optgroup label="Change case status to ">
        <option method="post" value="/admin/ticketing/cases_update_status?status=new">New</option>
        <option method="post" value="/admin/ticketing/cases_update_status?status=open">Open</option>
        <option method="post" value="/admin/ticketing/cases_update_status?status=closed">Closed</option>
    </optgroup>
  </select>
  <input type="button" class="btn btn-default btn-small" id="btnAction" value="Go" />	  
</div>

<h2>
  <%= q = CaseQueue.find(params[:queue_id]) unless params[:queue_id].nil? %>
  Cases
  <%= " assigned to " + User.find(params[:user_id]).name unless params[:user_id].nil? %>
</h2>


<form id="frmBatch" action="" method="post">
	<%= token_tag %>
  <table class="table table-striped table-condensed">
  	<tr>
      <th><input type="checkbox" id="chkAll" /></th>
      <th>ID</th>
      <th>Received</th>
      <th>From</th>
      <th>Subject</th>
      <th>Status</th>
      <th>Priority</th>
      <th>Assigned to</th>
  	</tr>
  	<% @cases.each do |c| %>
  	<tr class="<%= "light" if c.status == "closed" %>">
      <td><input type="checkbox" name="case_id[]" class="shipment-chk" value="<%= c.id %>"/></td>
  		<td><%= link_to c.id, admin_ticketing_case_path(c) %></td>
      <td nowrap><%= systime c.received_at %></td>
      <td>
        <% if c.user_id %>
          <%= link_to c.user.name, admin_system_user_path(c.user_id) %>
        <% else %>
          <%= c.name %>
        <% end %>
      </td>
  		<td>
        <%= truncate c.subject, length: 40 %>
        <% unless c.attachments.blank? %>
          <i class="fa fa-paperclip"></i>
        <% end %>
      </td>
      <td><%= case_status_indicator c %></td>
      <td><%= case_priority_indicator c %></td>
  		<td><% unless c.assigned_to.nil? %>
  			<%= link_to c.assignee.name, admin_system_user_path(c.assigned_to) %>
  			<% else %>
  			- none -
  			<% end%>
  		</td>
  	</tr>
  	<% end %>
  </table>
</form>

<% content_for :title do %>
	Cases: <%= %>
<% end %>


<% content_for :menu do
    render "admin/shared/ticketing_menu"
end %>

<% content_for :breadcrumbs do %>
	<li><a href="#">Ticketing</a></li>
	<li><%= link_to "Queues", admin_ticketing_case_queues_path %></li>
    <% if q %>
        <li class="active"><%= q.name %></li>
    <% else %>
        <li class="active">All Cases</li>
    <% end %>
<% end %>

<% content_for :head do %>

	<script type="text/javascript">
	    $(document).ready(function () {

	        $("#btnAction").click(function () {
	            $("#frmBatch").attr("action", $("#selAction").val());
	            $("#frmBatch").attr("method", $("#selAction option:selected").attr("method"));
	            $("#frmBatch").submit();
	        });

          $("#chkAll").change(function() {

            if ($(this).prop("checked"))
              $(".shipment-chk").prop("checked", true);
            else
              $(".shipment-chk").prop("checked", false);
          });

	    });
    </script>

<% end %>
